setwd("~/GitHub/Brazilian-Milk-Production")
milk_production_rs_cities <- read.csv2('spreadsheet/table74_rs_cities.csv', skip=3, stringsAsFactors = FALSE, encoding="UTF-8")
milk_production_rs_cities<-milk_production_rs_cities[-(1:2),]
milk_production_rs_cities<-milk_production_rs_cities[-(498:510),]
colnames(milk_production_rs_cities) <- gsub("X",'',colnames(milk_production_rs_cities))
colnames(milk_production_rs_cities)[1] <- "Cities"
for(i in 2:ncol(milk_production_rs_cities)){
milk_production_rs_cities[,i]<-gsub("[...]","0",milk_production_rs_cities[,i])
milk_production_rs_cities[,i]<-gsub("[-]","0",milk_production_rs_cities[,i])
milk_production_rs_cities[,i]<-as.numeric(as.character(unlist(milk_production_rs_cities[,i])))
}
milk_production_rs_cities[,1]<-gsub(" [(]RS[)]","",milk_production_rs_cities[,1])
if (!require(rgdal)) {
install.packages("rgdal", repos = "http://cran.us.r-project.org")
require(rgdal)
}
if (!require(RColorBrewer)) {
install.packages("rgdal", repos = "http://cran.us.r-project.org")
require(RColorBrewer)
}
if (!require(dplyr)) {
install.packages("dplyr", repos = "http://cran.us.r-project.org")
require(dplyr)
}
if (!require(ggplot2)) {
install.packages("ggplot2", repos = "http://cran.us.r-project.org")
require(ggplot2)
}
if (!require(gganimate)) {
install.packages("gganimate", repos = "http://cran.us.r-project.org")
require(gganimate)
}
shape_rs <- readOGR("shape/Municipios_IBGE.shp", "Municipios_IBGE",use_iconv=TRUE, encoding="UTF-8")
shape_rs@data$Label_N[!shape_rs@data$Label_N %in% milk_production_rs_cities$Cities]
milk_production_rs_cities[239,1]<-"MaÃ§ambara"
milk_production_rs_cities[342,1]<-"Restinga Seca"
milk_production_rs_cities[369,1]<-"Santana do Livramento"
milk_production_rs_cities[483,1]<-"Vespasiano Correa"
milk_production_rs_cities[496,1]<-"Westfalia"
milk_production_rs_cities<-milk_production_rs_cities[order(milk_production_rs_cities$Cities),]
for(j in 2:ncol(milk_production_rs_cities)){
milk_production_rs_cities[,j]<-as.numeric(milk_production_rs_cities[,j])/1000
}
milk_production_rs_cities$id <- c(1:nrow(milk_production_rs_cities))
milk_production_rs_cities <- reshape::melt(milk_production_rs_cities, id.vars=c("Cities","id"))
shape_rs@data$id <- c(1:nrow(shape_rs@data))
shapefile_df <- fortify(shape_rs, region = 'id') %>% mutate(id = as.numeric(id))
shapefile_RS<-sp::merge(shapefile_df, shape_rs@data,by="id")
map_data <- shapefile_RS %>% left_join(milk_production_rs_cities, by = c("Label_N" = "Cities"))
colnames(map_data)[20]<-"year"
map_data<-map_data[,-(14:17)]
map_data<-map_data[,-(8:11)]
map_data[is.na(map_data$values),]
map_data$year<-as.numeric(as.character(map_data$year))
quantile( milk_production_rs_cities$value[milk_production_rs_cities$variable==2017], p = (0:5)/5 )
